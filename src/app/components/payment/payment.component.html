<div class="payment-container">
  <!-- Header Section -->
  <div class="payment-header">
    <div class="header-content">
      <h2>{{ getPaymentTitle() }}</h2>
      <button mat-icon-button class="close-button" (click)="closeDialog()" [disabled]="isProcessing">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="order-summary" *ngIf="data.cartItems && data.cartItems.length > 0">
      <span class="item-count">{{ data.cartItems.length }} item{{ data.cartItems.length > 1 ? 's' : '' }}</span>
      <span class="total-amount-header">Total: {{ totalAmount | currency:'USD':'symbol':'1.2-2' }}</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="payment-content">
    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" class="payment-form">
      
      <!-- Payment Method Selection -->
      <div class="form-section">
        <h3 class="section-title">Select Payment Method</h3>
        <div class="form-group payment-method-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Choose your payment method *</mat-label>
            <mat-select formControlName="paymentMethod" (selectionChange)="onPaymentMethodChange()">
              <mat-option *ngFor="let method of paymentMethods" [value]="method">
                {{ method }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="paymentForm.get('paymentMethod')?.hasError('required') && paymentForm.get('paymentMethod')?.touched">
              Please select a payment method
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Credit Card Form - Show when Credit Card is selected -->
      <div class="form-section" *ngIf="paymentForm.get('paymentMethod')?.value === 'Credit Card'">
        <h3 class="section-title">Card Information</h3>
        
        <div class="card-form-group">
          <div class="form-group">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Cardholder Name *</mat-label>
              <input matInput formControlName="cardName" placeholder="Enter name as shown on card">
              <mat-error *ngIf="paymentForm.get('cardName')?.hasError('required') && paymentForm.get('cardName')?.touched">
                Cardholder name is required
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-group card-details-group">
            <label class="card-label">Card Details *</label>
            <!-- Stripe Card Element will be mounted here -->
            <div id="card-element" #cardElement class="card-element"></div>
            <div class="card-hint">Enter your card number, expiry date, and CVC</div>
            <div *ngIf="errorMessage" class="stripe-error">
              {{ errorMessage }}
            </div>
          </div>

          <div class="form-group remember-card">
            <mat-checkbox formControlName="rememberCard" color="primary">
              Save this card for future payments
            </mat-checkbox>
          </div>
        </div>
      </div>

      <!-- Other Payment Methods -->
      <div class="form-section" *ngIf="paymentForm.get('paymentMethod')?.value === 'PayPal'">
        <h3 class="section-title">PayPal Payment</h3>
        <div class="alternative-payment">
          <p>You will be redirected to PayPal to complete your payment securely.</p>
        </div>
      </div>

      <div class="form-section" *ngIf="paymentForm.get('paymentMethod')?.value === 'Cash'">
        <h3 class="section-title">Cash Payment</h3>
        <div class="alternative-payment">
          <p>Please have exact cash ready when your order arrives.</p>
        </div>
      </div>

      <!-- Footer with Total and Actions -->
      <div class="payment-footer">
        <div class="total-section">
          <div class="total-line">
            <span class="total-label">Total Amount:</span>
            <span class="total-value">{{ totalAmount | currency:'USD':'symbol':'1.2-2' }}</span>
          </div>
        </div>

        <div class="action-buttons">
          <button mat-stroked-button type="button" 
                  (click)="closeDialog()" [disabled]="isProcessing" class="cancel-btn">
            {{ isProcessing ? 'Cancelling...' : 'Cancel' }}
          </button>

          <button mat-raised-button color="primary" type="button" 
                  (click)="onSubmit()" 
                  [disabled]="paymentForm.invalid || isProcessing" class="pay-btn">
            <span *ngIf="!isProcessing">Pay Now</span>
            <span *ngIf="isProcessing" class="processing">
              <mat-spinner diameter="20"></mat-spinner>
              Processing...
            </span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>